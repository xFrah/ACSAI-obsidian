We reduce SAT to a subset of it, 3-CNF-SAT, and we use that for proving that everything else is in NP too.

## 3-CNF-SAT

Handling all the forms of the formulas in SAT problem is hard, in practice.
To simplify this, we only input formulas in [[CNF]] (Conjunctive Normal Forms).

> [!hint]
> It's called 3-CNF because each clause has 3 literals.


The cool thing of CNF is that for it to be satisfiable, at least one literal in each clause is 1. Even though if this simplifies stuff, it is still NP-Complete.
3-CNF is the last model for which it is still NP-Complete (2-CNF is polynomial)

### Reduction from SAT

In order to show that the two problems are equivalent, we need to show that **every boolean formula** φ **can be turned into an equivalent** (i.e., equi-satisfiable) **3-CNF formula**.

> [!hint]
> We want a polynomial function that turns a formula into a CNF formula, such that if the result is satisfiable, the original formula is also satisfiable.

##### Tree data structure

We construct a data structure specifically for this purpose, and we use it on the original formula (to turn it into CNF).

**Binary parse tree**:
- internal nodes = logical operators
- leaves = variables

We call the output of each internal node $y_i$.

> [!example]
> ![[Pasted image 20251129093131.png]]


##### Fitting the original formula to the tree

1. We use associativity to have only 1 or 2 children for each node (remove 3+ way clauses).
2. Start from the outermost clause, and begin building the tree from top-down. Assign symbol $y_i$ to each node.

##### Getting the new formula

**STEP 1**:
Construct the tree.
Once we have the tree, the new formula φ’ is the AND of the root variable $y_1$ and a conjunction of subformulae describing the operation of each node.

**ALL SUB-FORMULAE HAVE AT MOST 3 LITERALS**

> [!example] Explanation of **example above**
> $\leftrightarrow$ means that the two sides are logically equivalent.
> So the whole thing basically means:
> - If $y_1$ is true, with $y_1$ being equal to $(y_2 \land \lnot x_2)$
> - AND $y_2$ is equal to ($y_3 \lor y_4$)
> - AND ...


**STEP 2**:
The formula already is a conjunction, and the clauses all have at most 3 literals.
We now get the truth table for each clause, and we convert each one to CNF.


> [!example]
> ![[Pasted image 20251129102822.png]]


**STEP 3**:
Step 2 may yield clauses that have 1 or 2 literals, but we want each clause to have exactly 3.

- If we have only 2 literals for a clause, create arbitrary variables p and p negated, and make 2 3-literals clauses.
- If we have only 1 literals for a clause, create 2 arbitrary variables, and convert to 4 clauses with all the combination.